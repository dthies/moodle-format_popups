define ("format_popups/choice",["exports","core/config","core/fragment","core/notification","core/templates"],function(a,b,c,d,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=g(b);c=g(c);d=g(d);f=g(f);function g(a){return a&&a.__esModule?a:{default:a}}var i,j;a.init=function init(a,c){i=a;j=c;document.querySelector("#format_popups_activity_content").removeEventListener("click",h);document.querySelector("#format_popups_activity_content").addEventListener("click",h);document.querySelectorAll("form#selectgroup select").forEach(function(a){var b=a.getAttribute("id"),c=a.closest("form"),d;if(b){var e=document.querySelector("label[for=\""+b+"\"]");a.setAttribute(b,b+"_popup");if(e){e.setAttribute("for",b+"_popup")}}d=c.innerHTML;f.default.replaceNodeContents("form#selectgroup",d,"")});document.querySelector("#format_popups_activity_content").removeEventListener("change",l,{capture:!0});document.querySelector("#format_popups_activity_content").addEventListener("change",l,{capture:!0});document.querySelectorAll("a").forEach(function(a){if(a.getAttribute("href")&&0!==a.getAttribute("href").search("http")){a.setAttribute("href",b.default.wwwroot+"/mod/choice/"+a.getAttribute("href"))}})};function h(a){var b=a.target.closest("a");if(b){var e=new URL(b.getAttribute("href")),g=e.searchParams;if(e.toString()&&0<e.pathname.search("mod/choice/report.php")){var h=new XMLHttpRequest;a.preventDefault();a.stopPropagation();h.onreadystatechange=function(){if(4==this.readyState&&200==this.status){k(h.responseText)}};h.open("GET",e.toString(),!0);h.send()}if(e.toString()&&0<e.pathname.search("mod/choice/view.php")){a.preventDefault();a.stopPropagation();c.default.loadFragment("format_popups","mod",i,{jsondata:JSON.stringify(g.toString()),modname:j}).then(f.default.replaceNodeContents.bind(f.default,"#format_popups_activity_content")).fail(d.default.exception)}}}var k=function(a){var c=document.createElement("div");c.innerHTML=a;c.querySelectorAll("div.downloadreport form").forEach(function(a){a.setAttribute("action",b.default.wwwroot+"/mod/choice/"+a.getAttribute("action"))});f.default.replaceNodeContents("#format_popups_activity_content",c.querySelector("#page-content div[role=\"main\"]").innerHTML,"require(['core/checkbox-toggleall'], function(ToggleAll) { ToggleAll.init(); });")},l=function(a){var e=a.target.closest("form");if(e&&a.target.closest("select.custom-select")){var g=new FormData(e),h=new URL(e.getAttribute("action")),l=new URLSearchParams(g);a.stopPropagation();a.preventDefault();if(b.default.wwwroot+"/mod/choice/view.php"===e.getAttribute("action")){c.default.loadFragment("format_popups","mod",i,{jsondata:JSON.stringify(l.toString()),modname:j}).then(f.default.replaceNodeContents.bind(f.default,"#format_popups_activity_content")).fail(d.default.exception)}else if(b.default.wwwroot+"/mod/choice/report.php"===h.origin+h.pathname){var m=new XMLHttpRequest;m.onreadystatechange=function(){if(4==this.readyState&&200==this.status){k(m.responseText)}};m.open("POST",e.getAttribute("action"),!0);m.setRequestHeader("Content-Type","application/x-www-form-urlencoded");m.send(l.toString())}else{}}}});
//# sourceMappingURL=choice.min.js.map
