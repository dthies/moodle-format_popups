define ("format_popups/choice",["exports","core/config","core/fragment","core/notification","core/templates"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=f(b);c=f(c);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}var h,i;a.init=function init(a,c){h=a;i=c;document.querySelector("#format_popups_activity_content").removeEventListener("click",g);document.querySelector("#format_popups_activity_content").addEventListener("click",g);document.querySelectorAll("form#selectgroup select").forEach(function(a){var b=a.getAttribute("id"),c=a.closest("form"),d;if(b){var f=document.querySelector("label[for=\""+b+"\"]");a.setAttribute(b,b+"_popup");if(f){f.setAttribute("for",b+"_popup")}}d=c.innerHTML;e.default.replaceNodeContents("form#selectgroup",d,"")});document.querySelector("#format_popups_activity_content").removeEventListener("change",k,{capture:!0});document.querySelector("#format_popups_activity_content").addEventListener("change",k,{capture:!0});document.querySelectorAll("a").forEach(function(a){if(a.getAttribute("href")&&0!==a.getAttribute("href").search("http")){a.setAttribute("href",b.default.wwwroot+"/mod/choice/"+a.getAttribute("href"))}})};function g(a){var b=a.target.closest("a");if(b){var f=new URL(b.getAttribute("href")),g=f.searchParams;if(f.toString()&&0<f.pathname.search("mod/choice/report.php")){var k=new XMLHttpRequest;a.preventDefault();a.stopPropagation();k.onreadystatechange=function(){if(4==this.readyState&&200==this.status){j(k.responseText)}};k.open("GET",f.toString(),!0);k.send()}if(f.toString()&&0<f.pathname.search("mod/choice/view.php")){a.preventDefault();a.stopPropagation();c.default.loadFragment("format_popups","mod",h,{jsondata:JSON.stringify(g.toString()),modname:i}).then(function(a,b){e.default.replaceNodeContents("#format_popups_activity_content",a,b)}).fail(d.default.exception)}}}var j=function(a){var c=document.createElement("div");c.innerHTML=a;c.querySelectorAll("div.downloadreport form").forEach(function(a){a.setAttribute("action",b.default.wwwroot+"/mod/choice/"+a.getAttribute("action"))});e.default.replaceNodeContents("#format_popups_activity_content",c.querySelector("#page-content div[role=\"main\"]").innerHTML,"require(['core/checkbox-toggleall'], function(ToggleAll) { ToggleAll.init(); });")},k=function(a){var f=a.target.closest("form");if(f&&a.target.closest("select.custom-select")){var g=new FormData(f),k=new URL(f.getAttribute("action")),l=new URLSearchParams(g);a.stopPropagation();a.preventDefault();if(b.default.wwwroot+"/mod/choice/view.php"===f.getAttribute("action")){c.default.loadFragment("format_popups","mod",h,{jsondata:JSON.stringify(l.toString()),modname:i}).then(function(a,b){e.default.replaceNodeContents("#format_popups_activity_content",a,b)}).fail(d.default.exception)}else if(b.default.wwwroot+"/mod/choice/report.php"===k.origin+k.pathname){var m=new XMLHttpRequest;m.onreadystatechange=function(){if(4==this.readyState&&200==this.status){j(m.responseText)}};m.open("POST",f.getAttribute("action"),!0);m.setRequestHeader("Content-Type","application/x-www-form-urlencoded");m.send(l.toString())}else{}}}});
//# sourceMappingURL=choice.min.js.map
