define("format_popups/choice",["exports","core/config","core/fragment","core/notification","core/templates"],(function(_exports,_config,_fragment,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Module to add navigation to choice modal
   *
   * @module     format_popups/choice
   * @copyright  2021 Daniel Thies <dethies@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */var contextid,modname;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_config=_interopRequireDefault(_config),_fragment=_interopRequireDefault(_fragment),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);async function handleLink(e){let anchor=e.target.closest("a");if(anchor){let url=new URL(anchor.getAttribute("href")),params=url.searchParams;if(url.toString()&&url.pathname.search("mod/choice/report.php")>0){let xhttp=new XMLHttpRequest;e.preventDefault(),e.stopPropagation(),xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&showReport(xhttp.responseText)},xhttp.open("GET",url.toString(),!0),xhttp.send()}if(url.toString()&&url.pathname.search("mod/choice/view.php")>0){e.preventDefault(),e.stopPropagation();try{_templates.default.replaceNodeContents("#format_popups_activity_content",await _fragment.default.loadFragment("format_popups","mod",contextid,{jsondata:JSON.stringify(params.toString()),modname:modname}))}catch(e){_notification.default.exception(e)}}}}_exports.init=(id,name)=>{contextid=id,modname=name,document.querySelector("#format_popups_activity_content").removeEventListener("click",handleLink),document.querySelector("#format_popups_activity_content").addEventListener("click",handleLink),document.querySelectorAll("form#selectgroup select").forEach((function(select){let html,id=select.getAttribute("id"),form=select.closest("form");if(id){let label=document.querySelector('label[for="'+id+'"]');select.setAttribute(id,id+"_popup"),label&&label.setAttribute("for",id+"_popup")}html=form.innerHTML,_templates.default.replaceNodeContents("form#selectgroup",html,"")})),document.querySelector("#format_popups_activity_content").removeEventListener("change",changeGroup,{capture:!0}),document.querySelector("#format_popups_activity_content").addEventListener("change",changeGroup,{capture:!0}),document.querySelectorAll("a").forEach((function(anchor){anchor.getAttribute("href")&&0!==anchor.getAttribute("href").search("http")&&anchor.setAttribute("href",_config.default.wwwroot+"/mod/choice/"+anchor.getAttribute("href"))}))};const showReport=response=>{let container=document.createElement("div");container.innerHTML=response,container.querySelectorAll("div.downloadreport form").forEach((function(form){form.setAttribute("action",_config.default.wwwroot+"/mod/choice/"+form.getAttribute("action"))})),_templates.default.replaceNodeContents("#format_popups_activity_content",container.querySelector('#page-content div[role="main"]').innerHTML,"require(['core/checkbox-toggleall'], function(ToggleAll) { ToggleAll.init(); });")},changeGroup=async e=>{let form=e.target.closest("form");if(form&&e.target.closest("select.custom-select")){let formdata=new FormData(form),url=new URL(form.getAttribute("action")),params=new URLSearchParams(formdata);if(e.stopPropagation(),e.preventDefault(),_config.default.wwwroot+"/mod/choice/view.php"===form.getAttribute("action"))try{_templates.default.replaceNodeContents("#format_popups_activity_content",await _fragment.default.loadFragment("format_popups","mod",contextid,{jsondata:JSON.stringify(params.toString()),modname:modname}))}catch(e){_notification.default.exception(e)}else{if(_config.default.wwwroot+"/mod/choice/report.php"!==url.origin+url.pathname)return;{let xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&showReport(xhttp.responseText)},xhttp.open("POST",form.getAttribute("action"),!0),xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhttp.send(params.toString())}}}}}));

//# sourceMappingURL=choice.min.js.map