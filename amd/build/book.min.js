define("format_popups/book",["exports","core/config","core/fragment","core/notification","core/templates"],(function(_exports,_config,_fragment,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Module to add navigation to book modal
   *
   * @module     format_popups/book
   * @copyright  2021 Daniel Thies <dethies@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */var contextid;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.loadChapter=_exports.init=void 0,_config=_interopRequireDefault(_config),_fragment=_interopRequireDefault(_fragment),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.init=id=>{let content=document.querySelector("#format_popups_activity_content");contextid=id,content.removeEventListener("click",loadChapter),content.addEventListener("click",loadChapter),content.querySelectorAll("a").forEach((function(anchor){let href=anchor.getAttribute("href");href&&0===href.search("view.php")&&anchor.setAttribute("href",_config.default.wwwroot+"/mod/book/"+href)})),content.querySelector("#book_toc")&&!document.querySelector("#toggletoc")&&_templates.default.render("format_popups/booktoc",[]).then(_templates.default.prependNodeContents.bind(_templates.default,content.closest(".modal-content").querySelector(".modal-title"))).fail(_notification.default.exception)};const loadChapter=e=>{let anchor=e.target.closest("a.bookprev, a.booknext, .book_toc a");if(e.target.closest("a.bookexit")&&e.preventDefault(),anchor){let chapterid=anchor.getAttribute("data-chapterid")||new URLSearchParams(anchor.getAttribute("href")).get("chapterid"),params=new URLSearchParams({chapterid:chapterid});if(!chapterid)return;e.preventDefault(),e.stopPropagation(),_fragment.default.loadFragment("format_popups","mod",contextid,{jsondata:JSON.stringify(params.toString()),modname:"book"}).then(_templates.default.replaceNodeContents.bind(_templates.default,"#format_popups_activity_content")).fail(_notification.default.exception)}};_exports.loadChapter=loadChapter}));

//# sourceMappingURL=book.min.js.map