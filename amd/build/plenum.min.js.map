{"version":3,"file":"plenum.min.js","sources":["../src/plenum.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to add navigation to choice modal\n *\n * @module     format_popups/choice\n * @copyright  2021 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport config from 'core/config';\nimport Fragment from 'core/fragment';\nimport notification from 'core/notification';\nimport templates from 'core/templates';\n\nvar contextid, modname;\n\n/**\n * Initialize Choice mod actions\n *\n * @param {int} id Course module context id\n * @param {string} name Activity type\n */\nexport const init = (id, name) => {\n    'use strict';\n    contextid = id;\n    modname = name;\n\n    // Disable handler for  group selection form.\n    document.querySelectorAll('form#selectgroup select').forEach(function(select) {\n        let id = select.getAttribute('id'),\n            form = select.closest('form'),\n            html;\n        if (id) {\n            let label = document.querySelector('label[for=\"' + id + '\"]');\n            select.setAttribute(id, id + '_popup');\n            if (label) {\n                label.setAttribute('for', id + '_popup');\n            }\n        }\n        html = form.innerHTML;\n        templates.replaceNodeContents('form#selectgroup', html, '');\n    });\n    document.querySelector('#format_popups_activity_content').removeEventListener('change', changeGroup, {capture: true});\n    document.querySelector('#format_popups_activity_content').addEventListener('change', changeGroup, {capture: true});\n};\n\n/**\n * Handle change group selector\n *\n * @param {object} e event\n */\nconst changeGroup = async(e) => {\n    let form = e.target.closest('form');\n    if (form && e.target.closest('select.custom-select')) {\n        let formdata = new FormData(form),\n            params = new URLSearchParams(formdata);\n        e.stopPropagation();\n        e.preventDefault();\n        if (config.wwwroot + '/mod/plenum/view.php' !== form.getAttribute('action')) {\n            return;\n        }\n        Fragment.loadFragment(\n            'format_popups',\n            'mod',\n            contextid,\n            {\n                jsondata: JSON.stringify(params.toString()),\n                modname: modname\n            }\n        ).then(\n            templates.replaceNodeContents.bind(templates, '#format_popups_activity_content')\n        ).fail(notification.exception);\n    }\n};\n"],"names":["contextid","modname","id","name","document","querySelectorAll","forEach","select","html","getAttribute","form","closest","label","querySelector","setAttribute","innerHTML","replaceNodeContents","removeEventListener","changeGroup","capture","addEventListener","async","e","target","formdata","FormData","params","URLSearchParams","stopPropagation","preventDefault","config","wwwroot","loadFragment","jsondata","JSON","stringify","toString","then","templates","bind","fail","notification","exception"],"mappings":";;;;;;;SA2BIA,UAAWC,yRAQK,CAACC,GAAIC,QAErBH,UAAYE,GACZD,QAAUE,KAGVC,SAASC,iBAAiB,2BAA2BC,SAAQ,SAASC,YAG9DC,KAFAN,GAAKK,OAAOE,aAAa,MACzBC,KAAOH,OAAOI,QAAQ,WAEtBT,GAAI,KACAU,MAAQR,SAASS,cAAc,cAAgBX,GAAK,MACxDK,OAAOO,aAAaZ,GAAIA,GAAK,UACzBU,OACAA,MAAME,aAAa,MAAOZ,GAAK,UAGvCM,KAAOE,KAAKK,6BACFC,oBAAoB,mBAAoBR,KAAM,OAE5DJ,SAASS,cAAc,mCAAmCI,oBAAoB,SAAUC,YAAa,CAACC,SAAS,IAC/Gf,SAASS,cAAc,mCAAmCO,iBAAiB,SAAUF,YAAa,CAACC,SAAS,WAQ1GD,YAAcG,MAAAA,QACZX,KAAOY,EAAEC,OAAOZ,QAAQ,WACxBD,MAAQY,EAAEC,OAAOZ,QAAQ,wBAAyB,KAC9Ca,SAAW,IAAIC,SAASf,MACxBgB,OAAS,IAAIC,gBAAgBH,aACjCF,EAAEM,kBACFN,EAAEO,iBACEC,gBAAOC,QAAU,yBAA2BrB,KAAKD,aAAa,mCAGzDuB,aACL,gBACA,MACAhC,UACA,CACIiC,SAAUC,KAAKC,UAAUT,OAAOU,YAChCnC,QAASA,UAEfoC,KACEC,mBAAUtB,oBAAoBuB,KAAKD,mBAAW,oCAChDE,KAAKC,sBAAaC"}