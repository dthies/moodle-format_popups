{"version":3,"file":"book.min.js","sources":["../src/book.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to add navigation to book modal\n *\n * @module     format_popups/book\n * @copyright  2021 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport config from 'core/config';\nimport Fragment from 'core/fragment';\nimport notification from 'core/notification';\nimport templates from 'core/templates';\n\nvar contextid;\n/**\n * Initial listerners to handle book navigation\n *\n * @param {int} id Course module context id\n */\nexport const init = (id) => {\n    'use strict';\n    let content = document.querySelector('#format_popups_activity_content');\n    contextid = id;\n    content.removeEventListener('click', loadChapter);\n    content.addEventListener('click', loadChapter);\n    content.querySelectorAll('a').forEach(function(anchor) {\n        let href = anchor.getAttribute('href');\n        if (href && href.search('view.php') === 0) {\n            anchor.setAttribute('href', config.wwwroot + '/mod/book/' + href);\n        }\n    });\n    if (content.querySelector('#book_toc') && !document.querySelector('#toggletoc')) {\n        content.closest('.modal-content').querySelectorAll('.modal-title').forEach(async function(header) {\n            try {\n                const node = await templates.render('format_popups/booktoc', []);\n                templates.prependNodeContents(\n                    header,\n                    node,\n                    ''\n                );\n            } catch (e) {\n                notification.exception(e);\n            }\n        });\n    }\n};\n\n/**\n * Load chapter from navigatioin\n *\n * @param {object} e event\n */\nexport const loadChapter = (e) => {\n    'use strict';\n    const anchor = e.target.closest('a.bookprev, a.booknext, .book_toc a');\n\n    if (e.target.closest('a.bookexit')) {\n        e.preventDefault();\n    }\n    if (anchor) {\n        const chapterid = anchor.getAttribute('data-chapterid'),\n            params = new URLSearchParams({\n                chapterid: chapterid\n            });\n        if (!chapterid) {\n            return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        try {\n            templates.replaceNodeContents(\n                '#format_popups_activity_content',\n                Fragment.loadFragment(\n                    'format_popups',\n                    'mod',\n                    contextid,\n                    {\n                        jsondata: JSON.stringify(params.toString()),\n                        modname: 'book'\n                    }\n                )\n            );\n        } catch (e) {\n            notification.exception(e);\n        }\n    }\n};\n"],"names":["contextid","id","content","document","querySelector","removeEventListener","loadChapter","addEventListener","querySelectorAll","forEach","anchor","href","getAttribute","search","setAttribute","config","wwwroot","closest","async","header","node","templates","render","prependNodeContents","e","exception","target","preventDefault","chapterid","params","URLSearchParams","stopPropagation","replaceNodeContents","Fragment","loadFragment","jsondata","JSON","stringify","toString","modname"],"mappings":";;;;;;;SA2BIA,gTAMiBC,SAEbC,QAAUC,SAASC,cAAc,mCACrCJ,UAAYC,GACZC,QAAQG,oBAAoB,QAASC,aACrCJ,QAAQK,iBAAiB,QAASD,aAClCJ,QAAQM,iBAAiB,KAAKC,SAAQ,SAASC,YACvCC,KAAOD,OAAOE,aAAa,QAC3BD,MAAoC,IAA5BA,KAAKE,OAAO,aACpBH,OAAOI,aAAa,OAAQC,gBAAOC,QAAU,aAAeL,SAGhET,QAAQE,cAAc,eAAiBD,SAASC,cAAc,eAC9DF,QAAQe,QAAQ,kBAAkBT,iBAAiB,gBAAgBC,SAAQS,eAAeC,kBAE5EC,WAAaC,mBAAUC,OAAO,wBAAyB,uBACnDC,oBACNJ,OACAC,KACA,IAEN,MAAOI,yBACQC,UAAUD,cAW1BlB,YAAekB,UAElBd,OAASc,EAAEE,OAAOT,QAAQ,0CAE5BO,EAAEE,OAAOT,QAAQ,eACjBO,EAAEG,iBAEFjB,OAAQ,OACFkB,UAAYlB,OAAOE,aAAa,kBAClCiB,OAAS,IAAIC,gBAAgB,CACzBF,UAAWA,gBAEdA,iBAGLJ,EAAEG,iBACFH,EAAEO,yCAEYC,oBACN,kCACAC,kBAASC,aACL,gBACA,MACAlC,UACA,CACImC,SAAUC,KAAKC,UAAUR,OAAOS,YAChCC,QAAS,UAIvB,MAAOf,yBACQC,UAAUD"}