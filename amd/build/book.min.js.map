{"version":3,"file":"book.min.js","sources":["../src/book.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to add navigation to book modal\n *\n * @module     format_popups/book\n * @copyright  2021 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport config from 'core/config';\nimport Fragment from 'core/fragment';\nimport notification from 'core/notification';\nimport templates from 'core/templates';\n\nvar contextid;\n/**\n * Initial listerners to handle book navigation\n *\n * @param {int} id Course module context id\n */\nexport const init = (id) => {\n    'use strict';\n    let content = document.querySelector('#format_popups_activity_content');\n    contextid = id;\n    content.removeEventListener('click', loadChapter);\n    content.addEventListener('click', loadChapter);\n    content.querySelectorAll('a').forEach(function(anchor) {\n        let href = anchor.getAttribute('href');\n        if (href && href.search('view.php') === 0) {\n            anchor.setAttribute('href', config.wwwroot + '/mod/book/' + href);\n        }\n    });\n    if (content.querySelector('#book_toc') && !document.querySelector('#toggletoc')) {\n        templates.render('format_popups/booktoc', []).then(templates.prependNodeContents.bind(\n            templates,\n            content.closest('.modal-content').querySelector('.modal-title')\n        )).fail(notification.exception);\n    }\n};\n\n/**\n * Load chapter from navigatioin\n *\n * @param {object} e event\n */\nexport const loadChapter = (e) => {\n    'use strict';\n    let anchor = e.target.closest('a.bookprev, a.booknext, .book_toc a');\n\n    if (e.target.closest('a.bookexit')) {\n        e.preventDefault();\n    }\n    if (anchor) {\n        let chapterid = anchor.getAttribute('data-chapterid') ||\n            (new URLSearchParams(anchor.getAttribute('href'))).get('chapterid'),\n            params = new URLSearchParams({\n                chapterid: chapterid\n            });\n        if (!chapterid) {\n            return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        Fragment.loadFragment(\n            'format_popups',\n            'mod',\n            contextid,\n            {\n                jsondata: JSON.stringify(params.toString()),\n                modname: 'book'\n            }\n        ).then(\n            templates.replaceNodeContents.bind(templates, '#format_popups_activity_content')\n        ).fail(notification.exception);\n    }\n};\n"],"names":["contextid","id","content","document","querySelector","removeEventListener","loadChapter","addEventListener","querySelectorAll","forEach","anchor","href","getAttribute","search","setAttribute","config","wwwroot","render","then","templates","prependNodeContents","bind","closest","fail","notification","exception","e","target","preventDefault","chapterid","URLSearchParams","get","params","stopPropagation","loadFragment","jsondata","JSON","stringify","toString","modname","replaceNodeContents"],"mappings":";;;;;;;SA2BIA,gTAMiBC,SAEbC,QAAUC,SAASC,cAAc,mCACrCJ,UAAYC,GACZC,QAAQG,oBAAoB,QAASC,aACrCJ,QAAQK,iBAAiB,QAASD,aAClCJ,QAAQM,iBAAiB,KAAKC,SAAQ,SAASC,YACvCC,KAAOD,OAAOE,aAAa,QAC3BD,MAAoC,IAA5BA,KAAKE,OAAO,aACpBH,OAAOI,aAAa,OAAQC,gBAAOC,QAAU,aAAeL,SAGhET,QAAQE,cAAc,eAAiBD,SAASC,cAAc,kCACpDa,OAAO,wBAAyB,IAAIC,KAAKC,mBAAUC,oBAAoBC,KAC7EF,mBACAjB,QAAQoB,QAAQ,kBAAkBlB,cAAc,kBACjDmB,KAAKC,sBAAaC,kBAShBnB,YAAeoB,QAEpBhB,OAASgB,EAAEC,OAAOL,QAAQ,0CAE1BI,EAAEC,OAAOL,QAAQ,eACjBI,EAAEE,iBAEFlB,OAAQ,KACJmB,UAAYnB,OAAOE,aAAa,mBAC/B,IAAIkB,gBAAgBpB,OAAOE,aAAa,SAAUmB,IAAI,aACvDC,OAAS,IAAIF,gBAAgB,CACzBD,UAAWA,gBAEdA,iBAGLH,EAAEE,iBACFF,EAAEO,oCACOC,aACL,gBACA,MACAlC,UACA,CACImC,SAAUC,KAAKC,UAAUL,OAAOM,YAChCC,QAAS,SAEfrB,KACEC,mBAAUqB,oBAAoBnB,KAAKF,mBAAW,oCAChDI,KAAKC,sBAAaC"}