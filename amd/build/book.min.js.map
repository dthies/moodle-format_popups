{"version":3,"sources":["../src/book.js"],"names":["contextid","init","id","content","document","querySelector","removeEventListener","loadChapter","addEventListener","querySelectorAll","forEach","anchor","href","getAttribute","search","setAttribute","config","wwwroot","templates","render","then","prependNodeContents","bind","closest","e","target","preventDefault","chapterid","URLSearchParams","get","params","stopPropagation","Fragment","loadFragment","jsondata","JSON","stringify","toString","modname","html","js","replaceNodeContents","fail","notification","exception"],"mappings":"0NAuBA,OACA,OACA,OACA,O,sDAEIA,CAAAA,C,CAMSC,CAAI,CAAG,SAACC,CAAD,CAAQ,CAExB,GAAIC,CAAAA,CAAO,CAAGC,QAAQ,CAACC,aAAT,CAAuB,iCAAvB,CAAd,CACAL,CAAS,CAAGE,CAAZ,CACAC,CAAO,CAACG,mBAAR,CAA4B,OAA5B,CAAqCC,CAArC,EACAJ,CAAO,CAACK,gBAAR,CAAyB,OAAzB,CAAkCD,CAAlC,EACAJ,CAAO,CAACM,gBAAR,CAAyB,GAAzB,EAA8BC,OAA9B,CAAsC,SAASC,CAAT,CAAiB,CACnD,GAAIC,CAAAA,CAAI,CAAGD,CAAM,CAACE,YAAP,CAAoB,MAApB,CAAX,CACA,GAAID,CAAI,EAAgC,CAA5B,GAAAA,CAAI,CAACE,MAAL,CAAY,UAAZ,CAAZ,CAA2C,CACvCH,CAAM,CAACI,YAAP,CAAoB,MAApB,CAA4BC,UAAOC,OAAP,CAAiB,YAAjB,CAAgCL,CAA5D,CACH,CACJ,CALD,EAMA,GAAIT,CAAO,CAACE,aAAR,CAAsB,WAAtB,GAAsC,CAACD,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAA3C,CAAiF,CAC7Ea,UAAUC,MAAV,CAAiB,uBAAjB,CAA0C,EAA1C,EAA8CC,IAA9C,CAAmDF,UAAUG,mBAAV,CAA8BC,IAA9B,CAC/CJ,SAD+C,CAE/Cf,CAAO,CAACoB,OAAR,CAAgB,gBAAhB,EAAkClB,aAAlC,CAAgD,cAAhD,CAF+C,CAAnD,CAIH,CACJ,C,UAOM,GAAME,CAAAA,CAAW,CAAG,SAACiB,CAAD,CAAO,CAE9B,GAAIb,CAAAA,CAAM,CAAGa,CAAC,CAACC,MAAF,CAASF,OAAT,CAAiB,qCAAjB,CAAb,CAEA,GAAIC,CAAC,CAACC,MAAF,CAASF,OAAT,CAAiB,YAAjB,CAAJ,CAAoC,CAChCC,CAAC,CAACE,cAAF,EACH,CACD,GAAIf,CAAJ,CAAY,CACR,GAAIgB,CAAAA,CAAS,CAAGhB,CAAM,CAACE,YAAP,CAAoB,gBAApB,GACX,GAAIe,CAAAA,eAAJ,CAAoBjB,CAAM,CAACE,YAAP,CAAoB,MAApB,CAApB,CAAD,CAAmDgB,GAAnD,CAAuD,WAAvD,CADJ,CAEIC,CAAM,CAAG,GAAIF,CAAAA,eAAJ,CAAoB,CACzBD,SAAS,CAAEA,CADc,CAApB,CAFb,CAKA,GAAI,CAACA,CAAL,CAAgB,CACZ,MACH,CACDH,CAAC,CAACE,cAAF,GACAF,CAAC,CAACO,eAAF,GACAC,UAASC,YAAT,CACI,eADJ,CAEI,KAFJ,CAGIjC,CAHJ,CAII,CACIkC,QAAQ,CAAEC,IAAI,CAACC,SAAL,CAAeN,CAAM,CAACO,QAAP,EAAf,CADd,CAEIC,OAAO,CAAE,MAFb,CAJJ,EAQElB,IARF,CAQO,SAASmB,CAAT,CAAeC,CAAf,CAAmB,CACtBtB,UAAUuB,mBAAV,CAA8B,iCAA9B,CAAiEF,CAAjE,CAAuEC,CAAvE,CACH,CAVD,EAUGE,IAVH,CAUQC,UAAaC,SAVrB,CAWH,CACJ,CA9BM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to add navigation to book modal\n *\n * @module     format_popups/book\n * @package    format_popups\n * @copyright  2021 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport config from 'core/config';\nimport Fragment from 'core/fragment';\nimport notification from 'core/notification';\nimport templates from 'core/templates';\n\nvar contextid;\n/**\n * Initial listerners to handle book navigation\n *\n * @param int contextid Course module context id\n */\nexport const init = (id) => {\n    'use strict';\n    let content = document.querySelector('#format_popups_activity_content');\n    contextid = id;\n    content.removeEventListener('click', loadChapter);\n    content.addEventListener('click', loadChapter);\n    content.querySelectorAll('a').forEach(function(anchor) {\n        let href = anchor.getAttribute('href');\n        if (href && href.search('view.php') === 0) {\n            anchor.setAttribute('href', config.wwwroot + '/mod/book/' + href);\n        }\n    });\n    if (content.querySelector('#book_toc') && !document.querySelector('#toggletoc')) {\n        templates.render('format_popups/booktoc', []).then(templates.prependNodeContents.bind(\n            templates,\n            content.closest('.modal-content').querySelector('.modal-title')\n        ));\n    }\n};\n\n/**\n * Load chapter from navigatioin\n *\n * @param object event\n */\nexport const loadChapter = (e) => {\n    'use strict';\n    let anchor = e.target.closest('a.bookprev, a.booknext, .book_toc a');\n\n    if (e.target.closest('a.bookexit')) {\n        e.preventDefault();\n    }\n    if (anchor) {\n        let chapterid = anchor.getAttribute('data-chapterid') ||\n            (new URLSearchParams(anchor.getAttribute('href'))).get('chapterid'),\n            params = new URLSearchParams({\n                chapterid: chapterid\n            });\n        if (!chapterid) {\n            return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n        Fragment.loadFragment(\n            'format_popups',\n            'mod',\n            contextid,\n            {\n                jsondata: JSON.stringify(params.toString()),\n                modname: 'book'\n            }\n        ).then(function(html, js) {\n            templates.replaceNodeContents('#format_popups_activity_content', html, js);\n        }).fail(notification.exception);\n    }\n};\n"],"file":"book.min.js"}