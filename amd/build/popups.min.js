define ("format_popups/popups",["exports","core/ajax","core/config","core_form/events","core/fragment","core/modal_events","core/modal_factory","core/notification","core/templates","format_popups/book","format_popups/embed"],function(a,b,c,d,f,g,h,i,j,k,l){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=m(b);c=m(c);f=m(f);g=m(g);h=m(h);i=m(i);j=m(j);k=m(k);l=m(l);function m(a){return a&&a.__esModule?a:{default:a}}var q=function(a,c,d){h.default.create({large:!0,title:"title",body:"<div id=\"format_popups_activity_content\"></div>"}).then(function(e){e.contextid=a;e.courseid=c;e.displaysection=d;e.modules=[];o.bind(e)();return b.default.call([{methodname:"format_popups_get_available_mods",args:{contextid:e.contextid},done:function(a){this.modules=a}.bind(e),fail:i.default.exception}])}).fail(i.default.exception)};a.init=q;function n(){f.default.loadFragment("format_popups","page",this.contextid,{displaysection:this.displaysection}).then(function(a,b){if(!a.length){return}j.default.replaceNodeContents("div.course-content",a,b);document.querySelectorAll("form#sectionmenu select").forEach(function(a){var b=a.closest("form"),c;a.removeAttribute("id");c=b.innerHTML;j.default.replaceNodeContents(b,c,"")})}).fail(i.default.exception);b.default.call([{methodname:"format_popups_get_available_mods",args:{contextid:this.contextid},done:function(a){this.modules=a}.bind(this),fail:i.default.exception}])}function o(){document.querySelector("body").addEventListener("click",function(a){var b=a.target.closest("a");if(b&&b.getAttribute("href")&&b.getAttribute("href").match("http")&&b.closest("div.course-content, #format_popups_activity_content")){var d=new URL(b.getAttribute("href")),e=d.searchParams.get("id");this.modules.forEach(function(b){if(e==b.id&&!d.searchParams.get("downloadown")&&c.default.wwwroot+"/mod/"+b.modname+"/view.php"===d.origin+d.pathname||d.searchParams.get("a")==b.instance&&c.default.wwwroot+"/mod/"+b.modname+"/report.php"===d.origin+d.pathname&&"h5pactivity"===b.modname){a.preventDefault();a.stopPropagation();this.setTitle(b.title);j.default.replaceNodeContents("#format_popups_activity_content","<div style=\"height: 275px;\"></div>","");f.default.loadFragment("format_popups","mod",b.contextid,{jsondata:JSON.stringify(d.searchParams.toString()),modname:b.modname,path:d.pathname}).then(j.default.replaceNodeContents.bind(j.default,"#format_popups_activity_content")).fail(i.default.exception);this.show()}}.bind(this))}}.bind(this));this.getRoot().on(g.default.hidden,n.bind(this));document.addEventListener(d.types.uploadCompleted,function(){b.default.call([{methodname:"format_popups_get_available_mods",args:{contextid:this.contextid},done:function(a){this.modules=a}.bind(this),fail:i.default.exception}])}.bind(this));document.querySelector("div.course-content").addEventListener("submit",p.bind(this));this.getRoot().on(g.default.hidden,function(){var a=document.querySelector("#format_popups_activity_content");if(a){a.removeEventListener("click",k.default);a.removeEventListener("resize",l.default)}});document.querySelectorAll("#page-navbar, #nav-drawer, div.course-content").forEach(function(a){a.addEventListener("click",function(a){var b=a.target.closest("a")||a.target;if(b&&b.getAttribute("href")){var d=b.getAttribute("href");if(0===d.search(c.default.wwwroot+"/course/view.php")){var e=new URL(d),f=e.searchParams;if(f.get("id")===this.courseid){this.displaysection=f.get("section");n.bind(this)();a.preventDefault();a.stopPropagation()}}}}.bind(this))}.bind(this));document.querySelector("div.course-content").addEventListener("change",function(a){var b=a.target.closest("form#sectionmenu");if(b){var d=new FormData(b),e=new URL(c.default.wwwroot+d.get("jump")),f=e.searchParams;if(f.get("id")===this.courseid){this.displaysection=f.get("section");n.bind(this)();a.preventDefault();a.stopPropagation()}}}.bind(this));document.querySelectorAll("form#sectionmenu select, form.togglecompletion").forEach(function(a){var b=a.closest("form"),c;a.removeAttribute("id");c=b.innerHTML;j.default.replaceNodeContents(b,c,"")})}function p(a){var b=a.target.closest("form.togglecompletion");if(b){var d=new FormData(b),e=new URL(b.getAttribute("action")),f=new URLSearchParams(d);if(c.default.wwwroot+"/course/togglecompletion.php"===e.origin+e.pathname){var g=new XMLHttpRequest,h=document.createElement("div");a.preventDefault();a.stopPropagation();f.append("fromajax",1);h.setAttribute("class","ajaxworking");b.appendChild(h);g.onreadystatechange=function(a){if(4==this.readyState&&200==this.status){n.bind(a)()}}.bind(g,this);g.open("POST",b.getAttribute("action"),!0);g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");g.send(f.toString())}}}});
//# sourceMappingURL=popups.min.js.map
