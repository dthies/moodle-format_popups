define ("format_popups/popups",["exports","core/ajax","core/config","core/fragment","core/modal_events","core/modal_factory","core/notification","core/templates","format_popups/book","format_popups/embed"],function(a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=k(b);c=k(c);d=k(d);e=k(e);f=k(f);g=k(g);h=k(h);i=k(i);j=k(j);function k(a){return a&&a.__esModule?a:{default:a}}var o=function(a,c,d){f.default.create({large:!0,title:"title",body:"<div id=\"format_popups_activity_content\"></div>"}).then(function(e){e.contextid=a;e.courseid=c;e.displaysection=d;e.modules=[];e.modulecount=document.querySelectorAll(".activity").length;m.bind(e)();return b.default.call([{methodname:"format_popups_get_available_mods",args:{contextid:e.contextid},done:function(a){this.modules=a}.bind(e),fail:g.default.exception}])}).fail(g.default.exception)};a.init=o;function l(){d.default.loadFragment("format_popups","page",this.contextid,{displaysection:this.displaysection}).then(function(a,b){if(!a.length){return}h.default.replaceNodeContents("div.course-content",a,b);document.querySelectorAll("form#sectionmenu select").forEach(function(a){var b=a.closest("form"),c;a.removeAttribute("id");c=b.innerHTML;h.default.replaceNodeContents(b,c,"")})}).fail(g.default.exception);b.default.call([{methodname:"format_popups_get_available_mods",args:{contextid:this.contextid},done:function(a){this.modules=a}.bind(this),fail:g.default.exception}])}function m(){document.querySelector("body").addEventListener("click",function(a){var b=a.target.closest("a");if(b&&b.getAttribute("href")&&!b.getAttribute("onclick")&&b.getAttribute("href").match("http")&&b.closest("div.course-content, #format_popups_activity_content")){var e=new URL(b.getAttribute("href")),f=e.searchParams.get("id");this.modules.forEach(function(b){if(f==b.id&&!e.searchParams.get("downloadown")&&c.default.wwwroot+"/mod/"+b.modname+"/view.php"===e.origin+e.pathname||e.searchParams.get("a")==b.instance&&c.default.wwwroot+"/mod/"+b.modname+"/report.php"===e.origin+e.pathname&&"h5pactivity"===b.modname){a.preventDefault();a.stopPropagation();this.setTitle(b.title);h.default.replaceNodeContents("#format_popups_activity_content","<div style=\"height: 275px;\"></div>","");d.default.loadFragment("format_popups","mod",b.contextid,{jsondata:JSON.stringify(e.searchParams.toString()),modname:b.modname,path:e.pathname}).then(h.default.replaceNodeContents.bind(h.default,"#format_popups_activity_content")).fail(g.default.exception);this.show()}}.bind(this))}}.bind(this));this.getRoot().on(e.default.hidden,l.bind(this));document.addEventListener("focusin",function(){if(this.modulecount===document.querySelectorAll(".activity").length){return}this.modulecount=document.querySelectorAll(".activity").length;b.default.call([{methodname:"format_popups_get_available_mods",args:{contextid:this.contextid},done:function(a){this.modules=a}.bind(this),fail:g.default.exception}])}.bind(this));document.querySelector("div.course-content").addEventListener("submit",n.bind(this));this.getRoot().on(e.default.hidden,function(){var a=document.querySelector("#format_popups_activity_content");if(a){a.removeEventListener("click",i.default);a.removeEventListener("resize",j.default)}});document.querySelectorAll("#page-navbar, #nav-drawer, div.course-content").forEach(function(a){a.addEventListener("click",function(a){var b=a.target.closest("a")||a.target;if(b&&b.getAttribute("href")){var d=b.getAttribute("href");if(0===d.search(c.default.wwwroot+"/course/view.php")){var e=new URL(d),f=e.searchParams;if(!f.has("sesskey")&&!d.includes("#")&&f.get("id")===this.courseid){this.displaysection=f.get("section");l.bind(this)();a.preventDefault();a.stopPropagation()}}}}.bind(this))}.bind(this));document.querySelector("div.course-content").addEventListener("change",function(a){var b=a.target.closest("form#sectionmenu");if(b){var d=new FormData(b),e=new URL(c.default.wwwroot+d.get("jump")),f=e.searchParams;if(f.get("id")===this.courseid){this.displaysection=f.get("section");l.bind(this)();a.preventDefault();a.stopPropagation()}}}.bind(this));document.querySelectorAll("form#sectionmenu select, form.togglecompletion").forEach(function(a){var b=a.closest("form"),c;a.removeAttribute("id");c=b.innerHTML;h.default.replaceNodeContents(b,c,"")});window.addEventListener("blur",function(){if(document.getElementById("format_popups_activity_content")&&"0px"==window.getComputedStyle(document.getElementById("format_popups_activity_content")).height){this.hide()}}.bind(this))}function n(a){var b=a.target.closest("form.togglecompletion");if(b){var d=new FormData(b),e=new URL(b.getAttribute("action")),f=new URLSearchParams(d);if(c.default.wwwroot+"/course/togglecompletion.php"===e.origin+e.pathname){var g=new XMLHttpRequest,h=document.createElement("div");a.preventDefault();a.stopPropagation();f.append("fromajax",1);h.setAttribute("class","ajaxworking");b.appendChild(h);g.onreadystatechange=function(a){if(4==this.readyState&&200==this.status){l.bind(a)()}}.bind(g,this);g.open("POST",b.getAttribute("action"),!0);g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");g.send(f.toString())}}}});
//# sourceMappingURL=popups.min.js.map
